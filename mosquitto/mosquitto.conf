# Pi Control Panel - Mosquitto MQTT Broker Configuration

# ===========================================
# Listener Configuration
# ===========================================

# MQTT listener - only accessible via Tailscale network
listener 1883 0.0.0.0

# WebSocket listener (optional, for web clients)
# listener 9001
# protocol websockets

# ===========================================
# Security Configuration
# ===========================================

# Require authentication
allow_anonymous false

# Password file
password_file /mosquitto/config/passwd

# Access control list
acl_file /mosquitto/config/acl.conf

# ===========================================
# Persistence
# ===========================================

persistence true
persistence_location /mosquitto/data/

# Retain messages across restarts
autosave_interval 300

# ===========================================
# Logging
# ===========================================

log_dest file /mosquitto/log/mosquitto.log
log_dest stdout

log_type error
log_type warning
log_type notice
log_type information

log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# ===========================================
# Connection Settings
# ===========================================

# Maximum inflight messages
max_inflight_messages 20

# Maximum queued messages per client
max_queued_messages 1000

# Message size limit (1MB)
message_size_limit 1048576

# Keep alive (seconds)
max_keepalive 120

# ===========================================
# Performance
# ===========================================

# Upgrade persistent clients
upgrade_outgoing_qos false

# Per listener settings
per_listener_settings false
